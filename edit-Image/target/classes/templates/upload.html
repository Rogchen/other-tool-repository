<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head lang="en">
    <title>title</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <link rel="shortcut icon" type="image/png" th:href="@{/assets/images/favicon.jpg}"/>
    <link rel="shortcut icon" th:href="@{/assets/images/favicon.ico}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
</head>
<body>
<div>
    <form id="uploadFileForm" onsubmit="return false;" name="uploadFileForm" class="form-horizontal" action="#" method="post">
        <div class="form-group col-xs-12 row">
            <span>图片预览</span>
            <img id="ImgPr" width="120" height="120"/>
        </div>
        <div class="form-group col-xs-12 row" style="margin:30px auto 10px auto;">
            <div class="col-xs-3" align="left">
                <label class="control-label">选择文件：</label>
            </div>
            <div class="col-xs-6">
                <input type="file" name="file" class="input-file" id="chooseImport"onchange="fileChoiceChangeEvent(this.value);"/>
                <input type="text" class="control-text" id="choiceFileTxt" readonly = "true" style="display: none;">
            </div>
        </div>
        <div class="selectFileTxt form-group col-xs-12">
            <p style="text-indent:60px"><label id="selectFileTxt"></label></p>
        </div>
        <div class="upload">
            <button onclick="importFile();">上传</button>
        </div>
    </form>
</div>
<script th:src="@{/assets/js/jQuery/jquery-2.1.1.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/plugins/layer/layer.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/plugins/ajaxfileupload.js}"></script>
<script>
    // 导入
    var layerFlag = false;
    function validFileName(fileName){
        if(fileName == ""){
            layer.alert("请选择文件!");
            return false;
        }
        var suffixIndex = fileName.lastIndexOf('.');
        if(suffixIndex <= 0){
            layer.alert(fileName + "文件格式错误!");
            return false;
        }
        var suffixIndex = fileName.lastIndexOf('.');
        if(suffixIndex <= 0){
            layer.alert(fileName + "文件格式错误!");
            return false;
        }
        var suffix = fileName.substr(suffixIndex + 1);
        suffix = jQuery.trim(suffix);

//         if(jQuery.trim(suffix).length <= 0 ||
//             "png" != jQuery.trim(suffix.toLowerCase()) ||
//             "jpeg" != jQuery.trim(suffix.toLowerCase())){
//             layer.alert(suffix + "文件格式暂不支持!");
//             return false;
//         }
        return true;
    }
    function fileChoiceChangeEvent(fileName) {
        $("#choiceFileTxt").val(fileName);
        $("#selectFileTxt").text(fileName);
    }

    //导入触发事件
    function importFile(){
        var productFileName = $("#choiceFileTxt").val();
        var validSuccess = validFileName(productFileName);

        if(!validSuccess){
            return false;
        }
        if(layerFlag){
            layer.msg("请不要重复上传");
            return false;
        }
        $.ajaxFileUpload({
            url : 'base/upload.sjson',
            secureuri: false,
            fileElementId: "chooseImport",
            dataType : 'json',
            data:{directoryName:"static/assets/upload"},
            method : 'post',
            success: function (result, status) {
                if(result.bizSuccess){
                  $("#ImgPr").attr("src","assets/upload/"+result.data.url);
                }else{
                    layer.msg(result.resultMsg, {icon: 5});
                    $("#choiceFileTxt").val("");
                    $("#selectFileTxt").text("");
                }
                layerFlag = true;
            },
            error: function (data, status, e) {
                layerFlag = true;
                layer.alert("网络请求失败");
            }
        });
        $("#parseProductBtn").html("导入");
        $("#parseProductBtn").removeAttr("disabled");
        return false;
    }
</script>
</body>
</html>